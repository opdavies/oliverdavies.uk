workspace('oliverdavies-uk'):
  description: Sculpin website for oliverdavies.uk.

command('disable'):
  env:
    COMPOSE_PROJECT_NAME: = @('namespace')
  exec: |
    #!bash(workspace:/)
    run docker-compose down

command('docker image build <git_commit>'):
  env:
    COMPOSE_PROJECT_NAME: = @('namespace')
    GIT_COMMIT_SHA: = input.argument('git_commit')
  exec: |
    #!bash(workspace:/)
    docker image build -f tools/docker/images/Dockerfile -t ${COMPOSE_PROJECT_NAME}-web:latest --target=nginx .
    docker image build -f tools/docker/images/Dockerfile -t ${COMPOSE_PROJECT_NAME}-web:${GIT_COMMIT_SHA} --target=nginx .

command('enable'):
  env:
    COMPOSE_PROJECT_NAME: = @('namespace')
  exec: |
    #!bash(workspace:/)
    passthru docker-compose up -d --build

command('ps'):
  env:
    COMPOSE_PROJECT_NAME: = @('namespace')
  exec: |
    #!bash(workspace:/)
    passthru docker-compose ps
