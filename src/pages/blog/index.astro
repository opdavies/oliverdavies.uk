---
import ListingPage from "~/components/ListingPage.astro";
import PageLayout from "~/layouts/PageLayout.astro";
import { getSlugFromFile } from "~/utils.ts";

const posts = await Astro.glob("../../posts/*.md");

// TODO: show all posts when running locally.
const filteredPosts = posts
  .filter((post) => !post.frontmatter.draft)
  .filter((post) => post.frontmatter.date);

const sortedPosts = filteredPosts
  .map((post) => {
    const slug = `/blog/${getSlugFromFile(post.file)}`;

    return { item: post, slug };
  })
  .sort(
    (a, b) =>
      new Date(b.item.frontmatter.date).valueOf() -
      new Date(a.item.frontmatter.date).valueOf()
  );
---

<ListingPage items={sortedPosts} title="Blog">
  <p slot="intro">
    This is where I publish my personal blog posts as well as technical posts
    and tutorials on topics such as Drupal, PHP, Tailwind CSS, automated
    testing, and systems administration.
  </p>
</ListingPage>
