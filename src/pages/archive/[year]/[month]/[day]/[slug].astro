---
import DailyEmailForm from "~/components/DailyEmailForm.astro";
import Layout from "~/layouts/DailyEmailLayout.astro";
import { getCollection } from 'astro:content';
import { format, formatDistance, formatRelative, subDays } from 'date-fns'

export async function getStaticPaths() {
  const emails = await getCollection('daily-email');

  return emails.map((email) => {
    const slug = email.data.permalink
      .replace("archive/", "")
      .replace("\n", "");

    const slugParts = slug.split("/");

    return {
      params: {
        day: format(email.data.pubDate, 'dd'),
        month: format(email.data.pubDate, 'MM'),
        slug: slugParts.reverse()[0],
        year: format(email.data.pubDate, 'Y'),
      },
      props: {
        email,
      },
    };
  });
}

const { Content } = await Astro.props.email.render();
const { title } = Astro.props.email.data;
---

<Layout title={title}>
  <Content />
</Layout>
